!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],function(n){return t.returnExportsGlobal=e(n)}):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(this,function(t){"use strict";var e,n,i,r,o,s,a,l,h;e=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.setPos=function(){return this.domInputor},e.prototype.getIEPosition=function(){return this.getPosition()},e.prototype.getPosition=function(){var t,e;return e=this.getOffset(),t=this.$inputor.offset(),e.left-=t.left,e.top-=t.top,e},e.prototype.getOldIEPos=function(){var t,e;return e=s.selection.createRange(),t=s.body.createTextRange(),t.moveToElementText(this.domInputor),t.setEndPoint("EndToEnd",e),t.text.length},e.prototype.getPos=function(){var t,e,n;return(n=this.range())?(t=n.cloneRange(),t.selectNodeContents(this.domInputor),t.setEnd(n.endContainer,n.endOffset),e=t.toString().length,t.detach(),e):s.selection?this.getOldIEPos():void 0},e.prototype.getOldIEOffset=function(){var t,e;return t=s.selection.createRange().duplicate(),t.moveStart("character",-1),e=t.getBoundingClientRect(),{height:e.bottom-e.top,left:e.left,top:e.top}},e.prototype.getOffset=function(){var e,n,i,r,o;return l.getSelection&&(i=this.range())?(i.endOffset-1>0&&i.endContainer===!this.domInputor&&(e=i.cloneRange(),e.setStart(i.endContainer,i.endOffset-1),e.setEnd(i.endContainer,i.endOffset),r=e.getBoundingClientRect(),n={height:r.height,left:r.left+r.width,top:r.top},e.detach()),n&&0!==(null!=n?n.height:void 0)||(e=i.cloneRange(),o=t(s.createTextNode("|")),e.insertNode(o[0]),e.selectNode(o[0]),r=e.getBoundingClientRect(),n={height:r.height,left:r.left,top:r.top},o.remove(),e.detach())):s.selection&&(n=this.getOldIEOffset()),n&&(n.top+=t(l).scrollTop(),n.left+=t(l).scrollLeft()),n},e.prototype.range=function(){var t;if(l.getSelection)return t=l.getSelection(),t.rangeCount>0?t.getRangeAt(0):null},e}(),n=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.getIEPos=function(){var t,e,n,i,r,o,a;return e=this.domInputor,o=s.selection.createRange(),r=0,o&&o.parentElement()===e&&(i=e.value.replace(/\r\n/g,"\n"),n=i.length,a=e.createTextRange(),a.moveToBookmark(o.getBookmark()),t=e.createTextRange(),t.collapse(!1),r=a.compareEndPoints("StartToEnd",t)>-1?n:-a.moveStart("character",-n)),r},e.prototype.getPos=function(){return s.selection?this.getIEPos():this.domInputor.selectionStart},e.prototype.setPos=function(t){var e,n;return e=this.domInputor,s.selection?(n=e.createTextRange(),n.move("character",t),n.select()):e.setSelectionRange&&e.setSelectionRange(t,t),e},e.prototype.getIEOffset=function(t){var e,n,i,r;return n=this.domInputor.createTextRange(),t||(t=this.getPos()),n.move("character",t),i=n.boundingLeft,r=n.boundingTop,e=n.boundingHeight,{left:i,top:r,height:e}},e.prototype.getOffset=function(e){var n,i,r;return n=this.$inputor,s.selection?(i=this.getIEOffset(e),i.top+=t(l).scrollTop()+n.scrollTop(),i.left+=t(l).scrollLeft()+n.scrollLeft(),i):(i=n.offset(),r=this.getPosition(e),i={left:i.left+r.left-n.scrollLeft(),top:i.top+r.top-n.scrollTop(),height:r.height})},e.prototype.getPosition=function(t){var e,n,r,o,s,a;return e=this.$inputor,r=function(t){return t=t.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>"),/firefox/i.test(navigator.userAgent)&&(t=t.replace(/\s/g,"&nbsp;")),t},void 0===t&&(t=this.getPos()),a=e.val().slice(0,t),n=e.val().slice(t),o="<span style='position: relative; display: inline;'>"+r(a)+"</span>",o+="<span id='caret' style='position: relative; display: inline;'>|</span>",o+="<span style='position: relative; display: inline;'>"+r(n)+"</span>",s=new i(e),s.create(o).rect()},e.prototype.getIEPosition=function(t){var e,n,i,r,o;return i=this.getIEOffset(t),n=this.$inputor.offset(),r=i.left-n.left,o=i.top-n.top,e=i.height,{left:r,top:o,height:e}},e}(),i=function(){function e(t){this.$inputor=t}return e.prototype.css_attr=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],e.prototype.mirrorCss=function(){var e,n=this;return e={position:"absolute",left:-9999,top:0,zIndex:-2e4},"TEXTAREA"===this.$inputor.prop("tagName")&&this.css_attr.push("width"),t.each(this.css_attr,function(t,i){return e[i]=n.$inputor.css(i)}),e},e.prototype.create=function(e){return this.$mirror=t("<div></div>"),this.$mirror.css(this.mirrorCss()),this.$mirror.html(e),this.$inputor.after(this.$mirror),this},e.prototype.rect=function(){var t,e,n;return t=this.$mirror.find("#caret"),e=t.position(),n={left:e.left,top:e.top,height:t.height()},this.$mirror.remove(),n},e}(),r={contentEditable:function(t){return!(!t[0].contentEditable||"true"!==t[0].contentEditable)}},o={pos:function(t){return t||0===t?this.setPos(t):this.getPos()},position:function(t){return s.selection?this.getIEPosition(t):this.getPosition(t)},offset:function(t){return this.getOffset(t)}},s=null,l=null,a=null,h=function(t){var e;return(e=null!=t?t.iframe:void 0)?(a=e,l=e.contentWindow,s=e.contentDocument||l.document):(a=void 0,l=window,s=document)},t.fn.caret=function(i,s,a){var l;return o[i]?(t.isPlainObject(s)?(h(s),s=void 0):h(a),l=r.contentEditable(this)?new e(this):new n(this),o[i].apply(l,[s])):t.error("Method "+i+" does not exist on jQuery.caret")},t.fn.caret.EditableCaret=e,t.fn.caret.InputCaret=n,t.fn.caret.Utils=r,t.fn.caret.apis=o}),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],function(t){return e(t)}):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(0,function(t){var e,n,i,r,o,s,a,l,h,u,c=[].slice,p=function(t,e){function n(){this.constructor=t}for(var i in e)f.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;e=t,i=function(){function t(t){this.currentFlag=null,this.controllers={},this.aliasMaps={},this.$inputor=e(t),this.setupRootElement(),this.listen()}return t.prototype.createContainer=function(t){var n;return null!=(n=this.$el)&&n.remove(),e(t.body).append(this.$el=e("<div class='atwho-container'></div>"))},t.prototype.setupRootElement=function(t,n){var i;if(null==n&&(n=!1),t)this.window=t.contentWindow,this.document=t.contentDocument||this.window.document,this.iframe=t;else{this.document=this.$inputor[0].ownerDocument,this.window=this.document.defaultView||this.document.parentWindow;try{this.iframe=this.window.frameElement}catch(t){if(i=t,this.iframe=null,e.fn.atwho.debug)throw new Error("iframe auto-discovery is failed.\nPlease use `setIframe` to set the target iframe manually.\n"+i)}}return this.createContainer((this.iframeAsRoot=n)?this.document:document)},t.prototype.controller=function(t){var e,n,i,r;if(this.aliasMaps[t])n=this.controllers[this.aliasMaps[t]];else{r=this.controllers;for(i in r)if(e=r[i],i===t){n=e;break}}return n||this.controllers[this.currentFlag]},t.prototype.setContextFor=function(t){return this.currentFlag=t,this},t.prototype.reg=function(t,e){var n,i;return i=(n=this.controllers)[t]||(n[t]=this.$inputor.is("[contentEditable]")?new s(this,t):new h(this,t)),e.alias&&(this.aliasMaps[e.alias]=t),i.init(e),this},t.prototype.listen=function(){return this.$inputor.on("compositionstart",function(t){return function(){var e;return null!=(e=t.controller())&&e.view.hide(),t.isComposing=!0}}(this)).on("compositionend",function(t){return function(){return t.isComposing=!1}}(this)).on("keyup.atwhoInner",function(t){return function(e){return t.onKeyup(e)}}(this)).on("keydown.atwhoInner",function(t){return function(e){return t.onKeydown(e)}}(this)).on("blur.atwhoInner",function(t){return function(e){var n;if(n=t.controller())return n.expectedQueryCBId=null,n.view.hide(e,n.getOpt("displayTimeout"))}}(this)).on("click.atwhoInner",function(t){return function(e){return t.dispatch(e)}}(this)).on("scroll.atwhoInner",function(t){return function(){var e;return e=t.$inputor.scrollTop(),function(n){var i,r;return i=n.target.scrollTop,e!==i&&null!=(r=t.controller())&&r.view.hide(n),e=i,!0}}}(this)())},t.prototype.shutdown=function(){var t,e,n;n=this.controllers;for(t in n)e=n[t],e.destroy(),delete this.controllers[t];return this.$inputor.off(".atwhoInner"),this.$el.remove()},t.prototype.dispatch=function(t){var e,n,i,r;i=this.controllers,r=[];for(e in i)n=i[e],r.push(n.lookUp(t));return r},t.prototype.onKeyup=function(t){var n;switch(t.keyCode){case a.ESC:t.preventDefault(),null!=(n=this.controller())&&n.view.hide();break;case a.DOWN:case a.UP:case a.CTRL:e.noop();break;case a.P:case a.N:t.ctrlKey||this.dispatch(t);break;default:this.dispatch(t)}},t.prototype.onKeydown=function(t){var n,i;if((i=null!=(n=this.controller())?n.view:void 0)&&i.visible())switch(t.keyCode){case a.ESC:t.preventDefault(),i.hide(t);break;case a.UP:t.preventDefault(),i.prev();break;case a.DOWN:t.preventDefault(),i.next();break;case a.P:if(!t.ctrlKey)return;t.preventDefault(),i.prev();break;case a.N:if(!t.ctrlKey)return;t.preventDefault(),i.next();break;case a.TAB:case a.ENTER:case a.SPACE:if(!i.visible())return;if(!this.controller().getOpt("spaceSelectsMatch")&&t.keyCode===a.SPACE)return;if(!this.controller().getOpt("tabSelectsMatch")&&t.keyCode===a.TAB)return;i.highlighted()?(t.preventDefault(),i.choose(t)):i.hide(t);break;default:e.noop()}},t}(),r=function(){function t(t,n){this.app=t,this.at=n,this.$inputor=this.app.$inputor,this.id=this.$inputor[0].id||this.uid(),this.expectedQueryCBId=null,this.setting=null,this.query=null,this.pos=0,this.range=null,0===(this.$el=e("#atwho-ground-"+this.id,this.app.$el)).length&&this.app.$el.append(this.$el=e("<div id='atwho-ground-"+this.id+"'></div>")),this.model=new l(this),this.view=new u(this)}return t.prototype.uid=function(){return(Math.random().toString(16)+"000000000").substr(2,8)+(new Date).getTime()},t.prototype.init=function(t){return this.setting=e.extend({},this.setting||e.fn.atwho["default"],t),this.view.init(),this.model.reload(this.setting.data)},t.prototype.destroy=function(){return this.trigger("beforeDestroy"),this.model.destroy(),this.view.destroy(),this.$el.remove()},t.prototype.callDefault=function(){var t,n,i;i=arguments[0],t=2<=arguments.length?c.call(arguments,1):[];try{return o[i].apply(this,t)}catch(t){return n=t,e.error(n+" Or maybe At.js doesn't have function "+i)}},t.prototype.trigger=function(t,e){var n,i;return null==e&&(e=[]),e.push(this),n=this.getOpt("alias"),i=n?t+"-"+n+".atwho":t+".atwho",this.$inputor.trigger(i,e)},t.prototype.callbacks=function(t){return this.getOpt("callbacks")[t]||o[t]},t.prototype.getOpt=function(t){try{return this.setting[t]}catch(t){return t,null}},t.prototype.insertContentFor=function(t){var n,i;return i=this.getOpt("insertTpl"),n=e.extend({},t.data("item-data"),{"atwho-at":this.at}),this.callbacks("tplEval").call(this,i,n,"onInsert")},t.prototype.renderView=function(t){var e;return e=this.getOpt("searchKey"),t=this.callbacks("sorter").call(this,this.query.text,t.slice(0,1001),e),this.view.render(t.slice(0,this.getOpt("limit")))},t.arrayToDefaultHash=function(t){var n,i,r,o;if(!e.isArray(t))return t;for(o=[],n=0,r=t.length;n<r;n++)i=t[n],e.isPlainObject(i)?o.push(i):o.push({name:i});return o},t.prototype.lookUp=function(t){var e,n;return(e=this.catchQuery(t))?(this.app.setContextFor(this.at),(n=this.getOpt("delay"))?this._delayLookUp(e,n):this._lookUp(e),e):(this.expectedQueryCBId=null,e)},t.prototype._delayLookUp=function(t,e){var n,i;return n=Date.now?Date.now():(new Date).getTime(),this.previousCallTime||(this.previousCallTime=n),i=e-(n-this.previousCallTime),0<i&&i<e?(this.previousCallTime=n,this._stopDelayedCall(),this.delayedCallTimeout=setTimeout(function(e){return function(){return e.previousCallTime=0,e.delayedCallTimeout=null,e._lookUp(t)}}(this),e)):(this._stopDelayedCall(),this.previousCallTime!==n&&(this.previousCallTime=0),this._lookUp(t))},t.prototype._stopDelayedCall=function(){if(this.delayedCallTimeout)return clearTimeout(this.delayedCallTimeout),this.delayedCallTimeout=null},t.prototype._generateQueryCBId=function(){return{}},t.prototype._lookUp=function(t){var n;return n=function(t,e){if(t===this.expectedQueryCBId)return e&&e.length>0?this.renderView(this.constructor.arrayToDefaultHash(e)):this.view.hide()},this.expectedQueryCBId=this._generateQueryCBId(),this.model.query(t.text,e.proxy(n,this,this.expectedQueryCBId))},t}(),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.prototype.catchQuery=function(){var t,e,n,i,r,o;return e=this.$inputor.val(),t=this.$inputor.caret("pos",{iframe:this.app.iframe}),o=e.slice(0,t),i=this.callbacks("matcher").call(this,this.at,o,this.getOpt("startWithSpace")),"string"==typeof i&&i.length<=this.getOpt("maxLen",20)?(r=t-i.length,n=r+i.length,this.pos=r,i={text:i,headPos:r,endPos:n},this.trigger("matched",[this.at,i.text])):(i=null,this.view.hide()),this.query=i},n.prototype.rect=function(){var t,n,i;if(t=this.$inputor.caret("offset",this.pos-1,{iframe:this.app.iframe}))return this.app.iframe&&!this.app.iframeAsRoot&&(n=e(this.app.iframe).offset(),t.left+=n.left,t.top+=n.top),i=this.app.document.selection?0:2,{left:t.left,top:t.top,bottom:t.top+t.height+i}},n.prototype.insert=function(t){var e,n,i,r,o;return e=this.$inputor,n=e.val(),i=n.slice(0,Math.max(this.query.headPos-this.at.length,0)),r=""===(r=this.getOpt("suffix"))?r:r||" ",t+=r,o=""+i+t+n.slice(this.query.endPos||0),e.val(o),e.caret("pos",i.length+t.length,{iframe:this.app.iframe}),e.is(":focus")||e.focus(),e.change()},n}(r),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.prototype._getRange=function(){var t;if(t=this.app.window.getSelection(),t.rangeCount>0)return t.getRangeAt(0)},n.prototype._setRange=function(t,n,i){if(null==i&&(i=this._getRange()),i)return n=e(n)[0],"after"===t?(i.setEndAfter(n),i.setStartAfter(n)):(i.setEndBefore(n),i.setStartBefore(n)),i.collapse(!1),this._clearRange(i)},n.prototype._clearRange=function(t){var e;if(null==t&&(t=this._getRange()),e=this.app.window.getSelection(),null==this.ctrl_a_pressed)return e.removeAllRanges(),e.addRange(t)},n.prototype._movingEvent=function(t){var e;return"click"===t.type||(e=t.which)===a.RIGHT||e===a.LEFT||e===a.UP||e===a.DOWN},n.prototype._unwrap=function(t){var n;return t=e(t).unwrap().get(0),(n=t.nextSibling)&&n.nodeValue&&(t.nodeValue+=n.nodeValue,e(n).remove()),t},n.prototype.catchQuery=function(t){var n,i,r,o,s,l,h,u,c,p;if(!this.app.isComposing&&(p=this._getRange())){if(t.which===a.CTRL?this.ctrl_pressed=!0:t.which===a.A?null==this.ctrl_pressed&&(this.ctrl_a_pressed=!0):(delete this.ctrl_a_pressed,delete this.ctrl_pressed),t.which===a.ENTER)return(i=e(p.startContainer).closest(".atwho-query")).contents().unwrap(),i.is(":empty")&&i.remove(),(i=e(".atwho-query",this.app.document)).text(i.text()).contents().last().unwrap(),void this._clearRange();if(/firefox/i.test(navigator.userAgent)){if(e(p.startContainer).is(this.$inputor))return void this._clearRange();t.which===a.BACKSPACE&&p.startContainer.nodeType===document.ELEMENT_NODE&&(u=p.startOffset-1)>=0?(r=p.cloneRange(),r.setStart(p.startContainer,u),e(r.cloneContents()).contents().last().is(".atwho-inserted")&&(s=e(p.startContainer).contents().get(u),this._setRange("after",e(s).contents().last()))):t.which===a.LEFT&&p.startContainer.nodeType===document.TEXT_NODE&&(n=e(p.startContainer.previousSibling),n.is(".atwho-inserted")&&0===p.startOffset&&this._setRange("after",n.contents().last()))}return e(p.startContainer).closest(".atwho-inserted").addClass("atwho-query").siblings().removeClass("atwho-query"),(i=e(".atwho-query",this.app.document)).length>0&&i.is(":empty")&&0===i.text().length&&i.remove(),this._movingEvent(t)||i.removeClass("atwho-inserted"),r=p.cloneRange(),r.setStart(p.startContainer,0),h=this.callbacks("matcher").call(this,this.at,r.toString(),this.getOpt("startWithSpace")),0===i.length&&"string"==typeof h&&(o=p.startOffset-this.at.length-h.length)>=0&&(p.setStart(p.startContainer,o),i=e("<span/>",this.app.document).attr(this.getOpt("editableAtwhoQueryAttrs")).addClass("atwho-query"),p.surroundContents(i.get(0)),l=i.contents().last().get(0),/firefox/i.test(navigator.userAgent)?(p.setStart(l,l.length),p.setEnd(l,l.length),this._clearRange(p)):this._setRange("after",l,p)),"string"==typeof h&&h.length<=this.getOpt("maxLen",20)?(c={text:h,el:i},this.trigger("matched",[this.at,c.text]),this.query=c):(this.view.hide(),this.query={el:i},i.text().indexOf(this.at)>=0&&(this._movingEvent(t)&&i.hasClass("atwho-inserted")?i.removeClass("atwho-query"):!1!==this.callbacks("afterMatchFailed").call(this,this.at,i)&&this._setRange("after",this._unwrap(i.text(i.text()).contents().first()))),null)}},n.prototype.rect=function(){var t,n;return n=this.query.el.offset(),this.app.iframe&&!this.app.iframeAsRoot&&(t=e(this.app.iframe).offset(),n.left+=t.left-this.$inputor.scrollLeft(),n.top+=t.top-this.$inputor.scrollTop()),n.bottom=n.top+this.query.el.height(),n},n.prototype.insert=function(t){var e,n,i;return n=""===(n=this.getOpt("suffix"))?n:n||"\xa0",this.query.el.removeClass("atwho-query").addClass("atwho-inserted").html(t),(e=this._getRange())&&(e.setEndAfter(this.query.el[0]),e.collapse(!1),e.insertNode(i=this.app.document.createTextNode(n)),this._setRange("after",i,e)),this.$inputor.is(":focus")||this.$inputor.focus(),this.$inputor.change()},n}(r),l=function(){function t(t){this.context=t,this.at=this.context.at,this.storage=this.context.$inputor}return t.prototype.destroy=function(){return this.storage.data(this.at,null)},t.prototype.saved=function(){return this.fetch()>0},t.prototype.query=function(t,e){var n,i,r;return i=this.fetch(),r=this.context.getOpt("searchKey"),i=this.context.callbacks("filter").call(this.context,t,i,r)||[],n=this.context.callbacks("remoteFilter"),i.length>0||!n&&0===i.length?e(i):n.call(this.context,t,e)},t.prototype.fetch=function(){return this.storage.data(this.at)||[]},t.prototype.save=function(t){return this.storage.data(this.at,this.context.callbacks("beforeSave").call(this.context,t||[]))},t.prototype.load=function(t){if(!this.saved()&&t)return this._load(t)},t.prototype.reload=function(t){return this._load(t)},t.prototype._load=function(t){return"string"==typeof t?e.ajax(t,{dataType:"json"}).done(function(t){return function(e){return t.save(e)}}(this)):this.save(t)},t}(),u=function(){function t(t){this.context=t,this.$el=e("<div class='atwho-view'><ul class='atwho-view-ul'></ul></div>"),this.timeoutID=null,this.context.$el.append(this.$el),this.bindEvent()}return t.prototype.init=function(){var t;return t=this.context.getOpt("alias")||this.context.at.charCodeAt(0),this.$el.attr({id:"at-view-"+t})},t.prototype.destroy=function(){return this.$el.remove()},t.prototype.bindEvent=function(){var t;return t=this.$el.find("ul"),t.on("mouseenter.atwho-view","li",function(n){return t.find(".cur").removeClass("cur"),e(n.currentTarget).addClass("cur")}).on("click.atwho-view","li",function(n){return function(i){return t.find(".cur").removeClass("cur"),e(i.currentTarget).addClass("cur"),n.choose(i),i.preventDefault()}}(this))},t.prototype.visible=function(){return this.$el.is(":visible")},t.prototype.highlighted=function(){return this.$el.find(".cur").length>0},t.prototype.choose=function(t){var e,n;if((e=this.$el.find(".cur")).length&&(n=this.context.insertContentFor(e),this.context.insert(this.context.callbacks("beforeInsert").call(this.context,n,e),e),this.context.trigger("inserted",[e,t]),this.hide(t)),this.context.getOpt("hideWithoutSuffix"))return this.stopShowing=!0},t.prototype.reposition=function(t){var n,i,r,o;return n=this.context.app.iframeAsRoot?this.context.app.window:window,t.bottom+this.$el.height()-e(n).scrollTop()>e(n).height()&&(t.bottom=t.top-this.$el.height()),t.left>(r=e(n).width()-this.$el.width()-5)&&(t.left=r),i={left:t.left,top:t.bottom},null!=(o=this.context.callbacks("beforeReposition"))&&o.call(this.context,i),this.$el.offset(i),this.context.trigger("reposition",[i])},t.prototype.next=function(){var t,e;return t=this.$el.find(".cur").removeClass("cur"),e=t.next(),e.length||(e=this.$el.find("li:first")),e.addClass("cur"),this.scrollTop(Math.max(0,t.innerHeight()*(e.index()+2)-this.$el.height()))},t.prototype.prev=function(){var t,e;return t=this.$el.find(".cur").removeClass("cur"),e=t.prev(),e.length||(e=this.$el.find("li:last")),e.addClass("cur"),this.scrollTop(Math.max(0,t.innerHeight()*(e.index()+2)-this.$el.height()))},t.prototype.scrollTop=function(t){var e;return e=this.context.getOpt("scrollDuration"),e?this.$el.animate({scrollTop:t},e):this.$el.scrollTop(t)},t.prototype.show=function(){var t;return this.stopShowing?void(this.stopShowing=!1):(this.visible()||(this.$el.show(),this.$el.scrollTop(0),this.context.trigger("shown")),(t=this.context.rect())?this.reposition(t):void 0)},t.prototype.hide=function(t,e){var n;if(this.visible())return isNaN(e)?(this.$el.hide(),this.context.trigger("hidden",[t])):(n=function(t){return function(){return t.hide()}}(this),clearTimeout(this.timeoutID),this.timeoutID=setTimeout(n,e))},t.prototype.render=function(t){var n,i,r,o,s,a,l;if(!(e.isArray(t)&&t.length>0))return void this.hide();for(this.$el.find("ul").empty(),i=this.$el.find("ul"),l=this.context.getOpt("displayTpl"),r=0,s=t.length;r<s;r++)o=t[r],o=e.extend({},o,{"atwho-at":this.context.at}),a=this.context.callbacks("tplEval").call(this.context,l,o,"onDisplay"),n=e(this.context.callbacks("highlighter").call(this.context,a,this.context.query.text)),n.data("item-data",o),i.append(n);return this.show(),this.context.getOpt("highlightFirst")?i.find("li:first").addClass("cur"):void 0},t}(),a={DOWN:40,UP:38,ESC:27,TAB:9,ENTER:13,CTRL:17,A:65,P:80,N:78,LEFT:37,UP:38,RIGHT:39,DOWN:40,BACKSPACE:8,SPACE:32},o={beforeSave:function(t){return r.arrayToDefaultHash(t)},matcher:function(t,e,n,i){var r,o,s,a,l;return t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n&&(t="(?:^|\\s)"+t),r=decodeURI("%C3%80"),o=decodeURI("%C3%BF"),l=i?" ":"",a=new RegExp(t+"([A-Za-z"+r+"-"+o+"0-9_"+l+".+-]*)$|"+t+"([^\\x00-\\xff]*)$","gi"),s=a.exec(e),s?s[2]||s[1]:null},filter:function(t,e,n){var i,r,o,s;for(i=[],r=0,s=e.length;r<s;r++)o=e[r],~new String(o[n]).toLowerCase().indexOf(t.toLowerCase())&&i.push(o);return i},remoteFilter:null,sorter:function(t,e,n){var i,r,o,s;if(!t)return e;for(i=[],r=0,s=e.length;r<s;r++)o=e[r],o.atwho_order=new String(o[n]).toLowerCase().indexOf(t.toLowerCase()),o.atwho_order>-1&&i.push(o);return i.sort(function(t,e){return t.atwho_order-e.atwho_order})},tplEval:function(t,e){var n;n=t;try{return"string"!=typeof t&&(n=t(e)),n.replace(/\$\{([^\}]*)\}/g,function(t,n){return e[n]})}catch(t){return t,""}},highlighter:function(t,e){var n;return e?(n=new RegExp(">\\s*(\\w*?)("+e.replace("+","\\+")+")(\\w*)\\s*<","ig"),t.replace(n,function(t,e,n,i){return"> "+e+"<strong>"+n+"</strong>"+i+" <"})):t},beforeInsert:function(t){return t},beforeReposition:function(t){return t},afterMatchFailed:function(){}},n={load:function(t,e){var n;if(n=this.controller(t))return n.model.load(e)},isSelecting:function(){var t;return null!=(t=this.controller())?t.view.visible():void 0},hide:function(){var t;return null!=(t=this.controller())?t.view.hide():void 0},reposition:function(){var t;if(t=this.controller())return t.view.reposition(t.rect())},setIframe:function(t,e){return this.setupRootElement(t,e),null},run:function(){return this.dispatch()},destroy:function(){return this.shutdown(),this.$inputor.data("atwho",null)}},e.fn.atwho=function(t){var r,o;return r=arguments,o=null,this.filter('textarea, input, [contenteditable=""], [contenteditable=true]').each(function(){var s,a;return(a=(s=e(this)).data("atwho"))||s.data("atwho",a=new i(this)),"object"!=typeof t&&t?n[t]&&a?o=n[t].apply(a,Array.prototype.slice.call(r,1)):e.error("Method "+t+" does not exist on jQuery.atwho"):a.reg(t.at,t)}),null!=o?o:this},e.fn.atwho["default"]={at:void 0,alias:void 0,data:null,displayTpl:"<li>${name}</li>",insertTpl:"${atwho-at}${name}",callbacks:o,searchKey:"name",suffix:void 0,hideWithoutSuffix:!1,startWithSpace:!0,highlightFirst:!0,limit:5,maxLen:20,displayTimeout:300,delay:null,spaceSelectsMatch:!1,tabSelectsMatch:!0,editableAtwhoQueryAttrs:{},scrollDuration:150},e.fn.atwho.debug=!1});